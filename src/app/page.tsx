"use client";

import { type NextPage } from "next";
import Head from "next/head";
import { useState, useEffect } from "react";
import Attendee from "./attendee";
import QRCodes from "./qr";

const Home: NextPage = () => {
  // State to store the string array from fetched data
  const [qrData, setQrData] = useState<string[]>([]);

  // Function to remove empty fields from a single object
  const removeEmptyFields = (obj: any) => {
    return Object.keys(obj).reduce((acc, key) => {
      // Add to accumulator only if value is not empty (null, undefined, or empty string)
      if (
        obj[key] !== null &&
        obj[key] !== undefined &&
        obj[key] !== "" &&
        obj[key] !== 0 && 
        obj[key] !== false &&
        !(Array.isArray(obj[key]) && obj[key].length === 0)
      ) {
        acc[key] = obj[key];
      }
      return acc;
    }, {});
  };

  // Fetch data and update state
  const fetchData = async () => {
    const response = await fetch('https://sheetdb.io/api/v1/suk4789z30hwh');
    const data = await response.json();

    // Remove empty fields from each object
    const cleanedData = data.map(removeEmptyFields);

    // Convert each cleaned object into a string
    const stringArray = cleanedData.map((item: any) => JSON.stringify(item));
    
    // Set stringified data to state
    setQrData(stringArray);
  };

  // Fetch data when the component mounts
  useEffect(() => {
    fetchData();
  }, []);

  return (
    <>
      <Head>
        <title>Event Management</title>
        <meta name="description" content="Generated by Krisha" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <QRCodes data={qrData} />
      <Attendee />
    </>
  );
};

export default Home;
